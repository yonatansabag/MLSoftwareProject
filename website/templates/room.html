{% extends "base.html" %}

{% block title %}Find Room{% endblock %}

{% block content %}
    <form method="post" action="/roomjoin" id="roomForm">
        <h3>Enter or Create Game Room</h3>
        <div class="form-group">
            <label for="name">Name:</label>
            <input type="text" id="name" class="form-control" placeholder="Your name goes here" name="name" value="{{ name }}" required/>
        </div>
        <div class="form-group" id="codeGroup" style="display: none;">
            <label for="code">Room Code:</label>
            <input type="text" id="code" class="form-control" placeholder="Room Code" name="code" value="{{ code }}"/>
        </div>
        <div class="form-group" id="numPlayersGroup" style="display: none;">
            <label for="num_players">Number of Players:</label>
            <select id="num_players" name="num_players" class="form-control">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>
        </div>
        <div class="form-group">
            <button type="submit" id="joinRoomButton" name="join" class="btn btn-primary">Join a Room</button>
            <button type="submit" id="createRoomButton" name="create" class="btn btn-success">Create a Room</button>
        </div>
        {% if error %}
        <div class="alert alert-danger">
            {{ error }}
        </div>
        {% endif %}
    </form>

    <!-- Add Socket.IO script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('roomForm');
            const codeGroup = document.getElementById('codeGroup');
            const numPlayersGroup = document.getElementById('numPlayersGroup');
            const createRoomButton = document.getElementById('createRoomButton');
            const joinRoomButton = document.getElementById('joinRoomButton');

            // Show/Hide fields based on button click
            createRoomButton.addEventListener('click', function() {
                codeGroup.style.display = 'none'; // Hide room code field
                numPlayersGroup.style.display = 'block'; // Show number of players dropdown
            });

            joinRoomButton.addEventListener('click', function() {
                codeGroup.style.display = 'block'; // Show room code field
                numPlayersGroup.style.display = 'none'; // Hide number of players dropdown
            });

            // Initialize Socket.IO connection
            const socket = io();

            // Listen for the 'game_started' event
            socket.on('game_started', function(data) {
                if (data.game_started) {
                    // Redirect to the guessing page with the room code
                    const roomCode = '{{ code }}'; // Use the room code from the input field or session
                    window.location.href = '/guessing?room_code=' + roomCode;
                }
            });
        });
    </script>
{% endblock %}
